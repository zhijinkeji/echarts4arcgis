// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/ChartFilterUtil",["dojo/_base/lang","esri/dijit/geoenrichment/utils/ObjectUtil","./ChartTypes","./builder/utils/ChartDataUtil"],function(q,t,u,m){var l={collectStatsForVariables:function(b,c,k,e,f){var g=0,a={min:Infinity,max:-Infinity,decimals:0,dataArray:[]};c.forEach(function(d,n){d.points.forEach(function(h,c){h=m.getPointValue({point:h,viewModel:e,currentFeatureIndex:f,index:c,seriesIndex:n,chartType:b,visualProperties:k,numPoints:d.points.length});
a.min=Math.min(a.min,h);a.max=Math.max(a.max,h);a.decimals=Math.max(a.decimals,t.getPlaces(h));a.dataArray.push(h);g++})});return{filterRanges:[a],numVariablesTotal:g}},filterSeriesItems:function(b,c,k,e,f,g,a){return a?l._filterAreas(b,c,e,f):l._filterVariables(b,c,k,e,f,g)},_filterAreas:function(b,c,k,e){var f=0,g={};k.forEach(function(a){g[a.fieldName]=a});if(u.isLineLike(b))b=c.filter(function(a,b){return!a.points.some(function(a){var d=m.getPointValue({point:a,viewModel:e,currentFeatureIndex:b});
a=g[a.fieldInfo.name];return d<a.min||d>a.max})}),f=b.length,b.length||(b.__firstSeriesItem=c[0]);else{var a={};c.forEach(function(b){b.points.forEach(function(b,d){if(!a[d]){var c=m.getPointValue({point:b,viewModel:e,currentFeatureIndex:d});b=g[b.fieldInfo.name];if(c<b.min||c>b.max)a[d]=!0}})});b=c.map(function(b){b=q.mixin({},b);b.__firstPoint=b.points[0];b.points=b.points.filter(function(b,c){return!a[c]});f=b.points.length;return b})}return{seriesItems:b,numShownElements:f}},_filterVariables:function(b,
c,k,e,f,g){var a,d=0,n=e[0];a=[];var h=1<c.length;c.forEach(function(r,c){var d=q.mixin({},r);d.points=[];r.points.forEach(function(a,e){a.originalIndex=e;e=m.getPointValue({point:a,viewModel:f,currentFeatureIndex:g,index:e,seriesIndex:c,chartType:b,visualProperties:k,numPoints:r.points.length});e<n.min||e>n.max?h&&(a=q.mixin({},a),a.hidden=!0,d.points.push(a)):d.points.push(a)});h?a.push(d):d.points.length&&a.push(d)});if(h){var l=0;a.forEach(function(a){l=Math.max(l,a.points.length)});for(var p=
0;p<l;p++)a.every(function(a){a=a.points[p];return!a||a.hidden})&&a.forEach(function(a){if(a=a.points[p])a._toRemove=!0});a=a.filter(function(a){a.points=a.points.filter(function(a){return!a._toRemove});return a.points.length})}a.forEach(function(a){a.points.forEach(function(a){a.hidden||d++})});return{seriesItems:a,numShownElements:d}},getFirstSeriesPoint:function(b){return b.__firstPoint},getFirstSeriesItem:function(b){return b.__firstSeriesItem}};return l});