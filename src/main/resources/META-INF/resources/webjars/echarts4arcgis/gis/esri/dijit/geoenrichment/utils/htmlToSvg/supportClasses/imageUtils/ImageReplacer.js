// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/htmlToSvg/supportClasses/imageUtils/ImageReplacer","esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when esri/dijit/geoenrichment/promise/all ../dom-style ../VisibilityChecker ../../../ImageInfoUtil".split(" "),function(m,n,l,u,p,q){var r={},v=/^data:/i,t=/dijit\/geoenrichment\//i,w=/^url\s*\(/i,x=/url\(["']data:|url\(data:/i,k={getImages:function(a,d,c){a=a.getElementsByTagName("img");for(var e=[],b=0;b<a.length;b++){var f=a[b];v.test(f.src)===!!d&&
p.checkNode(f)&&(d||!c||t.test(f.src))&&e.push(a[b])}return e},getBackgroundImageNodes:function(a,d,c){function e(a){if(a&&a.children)for(var h=0;h<a.children.length;h++){var g=a.children[h];if("IMG"!==g.nodeName&&p.checkNode(g)){var f=u.get(g,"backgroundImage");if(f&&w.test(f)&&x.test(f)===!!d){g.__url=f.replace(/^url\s*\(/i,"").replace(")","").replace(/"/g,"").trim();if(!d&&c&&!t.test(g.__url))continue;b.push(g)}e(g)}}}var b=[];e(a);return b}},y={replaceImages:function(a,d){return l(a.map(function(c){return n(q.getRemoteImageDataUrl(c.src),
function(a){function b(){d.hideUrlImages&&(c.style.display="none")}if(a!==c.src){var e=c.src,h=new m;c.onload=function(){c.onload=c.onerror=null;h.resolve()};c.onerror=function(){c.onload=c.onerror=null;c.src=e;b()};c.src=a;return h.promise}b()})}))}},z={replaceBackgroundNodes:function(a,d){return l(a.map(function(a){var c=a.__url;delete a.__url;return n(q.getRemoteImageDataUrl(c),function(b){if(b!==c)return a.style.backgroundImage="url("+b+")",b=new m,setTimeout(b.resolve),b.promise;d.hideUrlImages&&
(a.style.display="none")})}))}},A={replaceWithItemResourceUrls:function(a,d,c){a.forEach(function(a){var b=c.getItemResourceUrl(a.src);b&&(a.src=b)});d.forEach(function(a){var b=a.__url;delete a.__url;if(b=c.getItemResourceUrl(b))a.style.backgroundImage="url("+b+")"})}};r.replaceImagesWithDataURL=function(a,d){var c=k.getImages(a,!1,!d.convertUrlImages),e=k.getBackgroundImageNodes(a,!1,!d.convertUrlImages),b=d.getItemResourceUrl&&k.getImages(a,!0);a=d.getItemResourceUrl&&k.getBackgroundImageNodes(a,
!0);return l([c&&y.replaceImages(c,d),e&&z.replaceBackgroundNodes(e,d),(b||a)&&A.replaceWithItemResourceUrls(b,a,d)])};return r});