// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/ImageInfoUtil",["dojo/_base/lang","esri/dijit/geoenrichment/when","./ImageUtil","./UrlUtil"],function(k,f,e,l){var m=/^data:/i,d={_infoCache:{},getImageInfo:function(a,c,b){var h=b&&b.sizeLimit||1E5;d._infoCache[a]||(d._infoCache[a]=e.imageFromUrl(a,b).then(function(g){var c=e.imageToDataURL(g),b={dataUrl:c,contentType:e.getContentType(c),width:g.width,height:g.height};setTimeout(function(){d._infoCache[a]=b});return b}));return f(d._infoCache[a],function(a){a=
k.mixin({},a);c&&(a.filename=c&&c.replace(/\.\w+$/,".png").toLowerCase());return function(a){return f(d._processDataUrl(a,h),function(c){if(c&&c.dataUrl){var b=k.mixin({},a);b.dataUrl=c.dataUrl;b.width*=c.factor;b.height*=c.factor;return f(b)}return f(a)})}(a)})},ensureDataUrlForRemoveImage:function(a,c){return!a||m.test(a)?a:d.getRemoteImageDataUrl(a,c)},getRemoteImageDataUrl:function(a,c){function b(b,c){return d.getImageInfo(b?e+"?"+a:a,null,{crossOrigin:c}).then(function(a){return f(d._processDataUrl(a,
g),function(a){return a&&a.dataUrl||a})})}function h(){console.log("Failed to get data for URL: "+a);return a}var g=c&&c.sizeLimit||1E5,e=l.getProxyUrl();return b(!1,"anonymous").otherwise(function(){return b(!1,null)}).otherwise(function(){return e?b(!0,"anonymous"):h()}).otherwise(function(){return b(!0,null)}).otherwise(h)},_processDataUrl:function(a,c){var b=Math.max(a.width,a.height);if(b<=c)return a.dataUrl;var d=c/b;return f(e.scaleImage(a.dataUrl,{factor:d}),function(a){return{dataUrl:a,factor:d}})}};
return d});