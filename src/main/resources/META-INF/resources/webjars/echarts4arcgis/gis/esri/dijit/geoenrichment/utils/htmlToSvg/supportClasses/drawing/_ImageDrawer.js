// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/htmlToSvg/supportClasses/drawing/_ImageDrawer",["esri/dijit/geoenrichment/when","../ElementBuilder","esri/dijit/geoenrichment/utils/ImageInfoUtil","esri/dijit/geoenrichment/utils/FitUtil"],function(m,v,t,w){var g={drawBackgroundImage:function(c,a){if(c.style.getBackground().image&&-1!==c.style.getBackground().image.indexOf("url")){var u=c.style.getBackground().image.replace("url(","").replace(")","").replace(/"/g,"");return g._drawImage(u,c,a,!1)}},drawImage:function(c,
a,u){return-1!==c.src.indexOf("application/json")?g._drawMap(c.src,a):g._drawImage(c.src,a,u,!0)},_drawImage:function(c,a,u,f){return m(this._preProcessImage(c,a,f),function(b){function f(b,d){return v.buildElement("image",{"xlink:href":c,x:a.box.x+a.style.getBorder().l.width+b,y:a.box.y+a.style.getBorder().t.width+d,width:p,height:q,opacity:a.style.opacity,clipParams:u,preserveAspectRatio:t,transform:a.style.transform})}var h=b&&b.w||a.style.getBackground().sizePx,k=b&&b.h||h,l=a.style.getBackground().positionXPx,
d=a.style.getBackground().positionYPx,n=-1!==a.style.getBackground().positionX.indexOf("%"),r=-1!==a.style.getBackground().positionY.indexOf("%");n&&(l=Number(a.style.getBackground().positionX.replace("%","")));r&&(d=Number(a.style.getBackground().positionY.replace("%","")));var g=a.style.getBackground().repeatX,m=a.style.getBackground().repeatY,e=b=0;h&&(b=n?(a.style.cw-h)*l/100:l,e=r?(a.style.ch-k)*d/100:d);var t;t=h||"contain"===a.style.getBackground().size?void 0:(n?0===l?"xMin":100===l?"xMax":
"xMid":"xMid")+(r?0===d?"YMin":100===d?"YMax":"YMid":"YMid")+" slice";var p=h||a.style.cw,q=k||a.style.ch;if(0>=p||0>=q)return null;if(g||m){h=[];if(0>=b)k=b;else for(k=b;0<k;)k-=p;d=k;for(l=0;d<a.style.cw;)d+=p,l++;if(0>=e)d=e;else for(d=e;0<d;)d-=q;r=d;for(n=0;r<a.style.ch;)r+=q,n++;if(g&&!m)for(b=0;b<l;b++)h.push(f(k+b*p,e));else if(!g&&m)for(e=0;e<n;e++)h.push(f(b,d+e*q));else for(b=0;b<l;b++)for(e=0;e<n;e++)h.push(f(k+b*p,d+e*q));return h}return[f(b,e)]})},_preProcessImage:function(c,a,g){if(g||
"cover"===a.style.getBackground().size)return null;if("auto"===a.style.getBackground().size)return m(t.getImageInfo(c),function(a){return{w:a.width,h:a.height}}).otherwise(function(){return null});var f=a.style.getBackground().sizePx;return a.style.getBackground().repeatX||a.style.getBackground().repeatY||f?m(t.getImageInfo(c),function(b){var c=b.width/b.height;return w.fitBox({w:b.width,h:b.height},{w:f||a.style.cw,h:f?f/c:a.style.ch})}).otherwise(function(){return null}):null},_drawMap:function(c,
a){return[v.buildElement("map",{"xlink:href":c,x:a.box.x+a.style.getBorder().l.width,y:a.box.y+a.style.getBorder().t.width,width:a.style.cw,height:a.style.ch,preserveAspectRatio:"xMinYMin slice"})]}};return g});